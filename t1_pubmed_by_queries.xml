<tool id="t1_pubmed_by_queries" name="T1_pubmed_by_queries" version="@VERSION@">
    <description>[description]</description>
    
    <requirements>             
      <requirement type="package" version="2.0.1">r-argparse</requirement>             
      <requirement type="package" version="2.13">r-easypubmed</requirement> 
    </requirements>
    
    <macros>
        <import>macros.xml</import>
    </macros>
    
    <expand macro="requirements"/>
    <expand macro="stdio"/>
    
    <command><![CDATA[Rscript 
      '${__tool_directory__}/T1_pubmed_by_queries.R'
      --input '$input'
      --output '$output'
      --number '$number'
      $abstract
      #if str($key):
      --key '$key'
      #end if
      ]]>
    </command>
    
    <inputs>
      <param argument="--input" label="Input file" name="input" optional="false" type="data" format="tabular" help="input"/>
      <param argument="--number" label="Number of PMIDs (or abstracts) to save per  ID." name="number" optional="false" type="integer" help="number" value="5"/>
      <param argument="--abstract" label="Instead of PMIDs, abstracts are saved." name="abstract" type="boolean" truevalue="--abstract" falsevalue="" help="abstract" checked="false"/>
      <param argument="--key" label="key" name="key" optional="true" type="text" help="key"/>
    </inputs>
    
    <outputs>
      <data format="tabular" name="output" />
    </outputs>
    
    <tests>
        <test>
          <param name="input" value="test_data" ftype="tabular"/>
          <param name="output" value="T1_result" ftype="tabular"/>
          <param name="number" value="1"/>
          <param name="abstract" value=""/>
          <param name="key" value=""/>
        </test>
    </tests>
    
    <help><![CDATA[

Input: Table with entities in column called “ID_<name>”, e.g. “ID_genes” if entities are genes.
The entities are successively used as search query in PubMed.

Output: Input table with additional columns containing PMIDs or abstracts from PubMed.


parser <- ArgumentParser()
parser$add_argument("-i", "--input", 
                    help = "input fie name. add path if file is not in workind directory")
parser$add_argument("-o", "--output", default="T1_result",
                    help = "output file name. [default \"%(default)s\"]")
parser$add_argument("-n", "--number", type="integer", default=5, choices=seq(1, 20), metavar="{0..20}",
                    help="Number of PMIDs (or abstracts) to save per  ID. [default \"%(default)s\"]")
parser$add_argument("-a", "--abstract", action="store_true", default=FALSE,
                    help="Instead of PMIDs, abstracts are saved.")
parser$add_argument("-k", "--key", type="character", 
                    help="If ncbi API key is available, add it to speed up the fetching of pubmed data.")
args <- parser$parse_args()


        ]]></help>
</tool>